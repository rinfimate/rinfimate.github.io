<html>
    <head>
        <title>
            QikPod Bluetooth
        </title>
        <script type="text/javascript">
            function onButtonClick() {
                alert('test');
                let serviceUuid = document.querySelector('#service').value;
                if (serviceUuid.startsWith('0x')) {
                    serviceUuid = parseInt(serviceUuid);
                }

                let characteristicUuid = document.querySelector('#characteristic').value;
                if (characteristicUuid.startsWith('0x')) {
                    characteristicUuid = parseInt(characteristicUuid);
                }

                alert('Requesting Bluetooth Device...');
                navigator.bluetooth.requestDevice({filters: [{services: [serviceUuid]}]})
                .then(device => {
                    alert('Connecting to GATT Server...');
                    return device.gatt.connect();
                })
                .then(server => {
                    alert('Getting Service...');
                    return server.getPrimaryService(serviceUuid);
                })
                .then(service => {
                    alert('Getting Characteristics...');
                    if (characteristicUuid) {
                    // Get all characteristics that match this UUID.
                    return service.getCharacteristics(characteristicUuid);
                    }
                    // Get all characteristics.
                    return service.getCharacteristics();
                })
                .then(characteristics => {
                    alert('> Characteristics: ' +
                    characteristics.map(c => c.uuid).join('\n' + ' '.repeat(19)));
                })
                .catch(error => {
                    alert('Argh! ' + error);
                });
            }
        </script>
    </head>
    <body>
        <button onclick="onButtonClick()">Click to Open</button>
    </body>
</html>
